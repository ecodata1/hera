<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Request for Comment: Shared Design Principles for Creating and Deploying Regulatory Methods • hera</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Request for Comment: Shared Design Principles for Creating and Deploying Regulatory Methods">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">hera</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-docs" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Docs</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-docs">
<li><a class="dropdown-item" href="../articles/hera_specifications.html">Request for comment - Shared Design Principles</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/hera_assessments.html">Regulatory Catalogue</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/development_guide.html">Development Guide</a></li>
    <li><a class="dropdown-item" href="../articles/deployment_guide.html">Deploy Guide</a></li>
    <li><a class="dropdown-item" href="../articles/data_dictionary.html">Glossary</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ecodata1/hera/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Request for Comment: Shared Design Principles for Creating and Deploying Regulatory Methods</h1>
            
            <h4 data-toc-skip class="date">2025-12-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ecodata1/hera/blob/main/vignettes/hera_specifications.Rmd" class="external-link"><code>vignettes/hera_specifications.Rmd</code></a></small>
      <div class="d-none name"><code>hera_specifications.Rmd</code></div>
    </div>

    
    
<style>
img {
border: 0px;
outline: 0 ;
}
</style>
<p>WORK IN PROGRESS - Drafting</p>
<div class="float">
<img src="images/heraverse_logo_2.png" style="width:50.0%" alt="Collage of hex logos for hera and related packages"><div class="figcaption">Collage of hex logos for hera and related
packages</div>
</div>
<p>WARNING: Blue sky thinking ahead</p>
<p>Keywords: collection, modelling, prediction, classification,
forecast, assessment, scenario</p>
<blockquote>
<p><strong>TL:DR - To get a flavour of running multiple classification
tools using a shared</strong> <strong>interface and data structures -
check out the <a href="https://ecodata.shinyapps.io/heraapp/" class="external-link">hera demo
website GUI</a></strong></p>
</blockquote>
<div class="section level2" number="1">
<h2 id="summary">
<span class="header-section-number">1</span> Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>We propose regulatory tools share a common set of design principles,
interfaces and data structures.</p>
<p>Specifically, we propose an official collection of R packages
designed to provide collaborative workflow for building and using
assessment tools. In turn, these packages will be unified into a single
package called ‘hera’. This provides a common interface to run
regulatory assessments. We expect this process will facilitate code
re-use, faster integration and knowledge exchange between method
developers and practitioners.</p>
</div>
<div class="section level2" number="2">
<h2 id="motivation">
<span class="header-section-number">2</span> Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h2>
<p>UKTAG has guided the development of an impressive range of
classification tools. This has involved many developers, researchers and
experts dedicating their time and effort to creating tools to better
understand pressures on the environment. We are confident that there are
many future opportunities for collaboration and tool development in
response to changing environmental pressures and improving scientific
understanding. As access to modelling tools become more routine, we
expect a proliferation of models and indices in the years ahead. For
instance, new tools for diagnosing pressures, updates to existing tools
and catchment scale planning. To aid better understanding of the
environment through effectively combining multiple models and tools, we
propose they share a common design philosophy to aid integration and
collaboration.</p>
</div>
<div class="section level2" number="3">
<h2 id="key-ideas">
<span class="header-section-number">3</span> Key Ideas<a class="anchor" aria-label="anchor" href="#key-ideas"></a>
</h2>
<p>The aims of a shared design philosophy for regulatory classification
R packages include:</p>
<ul>
<li>Create a single user interfaces, similar data formats and operating
procedures.</li>
<li>Allow outputs from multiple tools to be quickly generated and
combined together.</li>
<li>Shorten the time between development and integration into Agencies
systems.</li>
<li>Clearer path for researcher engagement and model development.</li>
<li>Make it easier to share and re-use code between tools for common
functions.</li>
<li>Share data quality standards and data validation code.</li>
<li>Apply similar approaches to code review, testing and
documentation.</li>
</ul>
<div class="section level3" number="3.1">
<h3 id="preparing-for-future">
<span class="header-section-number">3.1</span> Preparing for
future<a class="anchor" aria-label="anchor" href="#preparing-for-future"></a>
</h3>
<p>In the next 10 years…</p>
<p>We assume it is likely that our aquatic ecological models will be
subsumed into a more large scale environmental and climate models. These
‘total environment’ models may for instance use climate change models to
forecast impact on invertebrates, water-use models to predict the impact
on fish or spatial planning tools the impact on nutrient levels. The
outputs will be used across regulatory reporting for RBMP, flood
management, biodiversity improvements, carbon sequestering etc. Allowing
multi-discipline assessment of impacts and trade-offs for each planning
scenario and proposed measures - ensuring well-informed
decisions-making.</p>
<p>All ecological data along with supporting data such as chemistry,
climate, meteorological, geological, and satellite imagery, will be
freely and easily accessible. We assume agencies will upload all data
such as fish counter data, plant DNA or aerial imagery etc, into a
‘lake’ of environmental data.</p>
<p>To take step towards this vision, the underlying design of a models
and tools must be modular and easy to connect and integrate in a variety
of ways.</p>
</div>
</div>
<div class="section level2" number="4">
<h2 id="detailed-design">
<span class="header-section-number">4</span> Detailed Design<a class="anchor" aria-label="anchor" href="#detailed-design"></a>
</h2>
<p>To aid collaboration and respond to the changing environmentally
pressures, we propose creating a joint collections of packages to share
understanding on the environment while providing the software
infrastructure to lighten the burden of more mundane tasks involved in
maintaining and deploying new models and interfaces.</p>
<p>This proposal is influenced by the work within the climate change
research community such as the <a href="https://climt.readthedocs.io/en/latest/index.html" class="external-link">Climate
Modelling and Diagnostics Toolkit</a>, the MET office’s <a href="https://www.metoffice.gov.uk/research/approach/modelling-systems/unified-model/index" class="external-link">unified
model</a> approach. As well as best software practices such as on-going
work in the R community such as <a href="https://ropensci.org/" class="external-link">ropenSci</a> and research projects such as
the <a href="https://research-information.bris.ac.uk/ws/portalfiles/portal/63598981/evo_final_report_2014.pdf" class="external-link">Virtual
Observatory</a>.</p>
<div class="section level3" number="4.1">
<h3 id="shared-packages">
<span class="header-section-number">4.1</span> Shared Packages<a class="anchor" aria-label="anchor" href="#shared-packages"></a>
</h3>
<p>Currently we have a number of classification tool R packages shared
on github:</p>
<ol style="list-style-type: decimal">
<li>
<a href="https://github.com/nsj3/darleq3" class="external-link">darleq3</a> -
Phytobenthos<br>
</li>
<li>
<a href="https://github.com/aquaMetrics/fcs2" class="external-link">fsc2</a> - Scottish
river fish<br>
</li>
<li>
<a href="https://github.com/aquaMetrics/rict" class="external-link">rict</a> - General
invertebrate classification</li>
</ol>
<p>We propose these tools become part of official collection of packages
and we work towards making them inter-operable via the <code>hera</code>
package.</p>
</div>
<div class="section level3" number="4.2">
<h3 id="key-steps">
<span class="header-section-number">4.2</span> Key Steps<a class="anchor" aria-label="anchor" href="#key-steps"></a>
</h3>
<p>Here we introduce a prototype R package called <a href="https://github.com/ecodata1/hera" class="external-link">hera</a>. The key idea, is
<code>hera</code> provides a common interface for existing WFD packages
and future developments. This is achieved through a set of shared
functions required to run and report classification. It builds on the
best practice idea of how to <a href="https://r4ds.had.co.nz/many-models.html" class="external-link">run many models</a>
simultaneously in R while keeping the input and output data formats
simple and homogeneous. We explain each function in detail below. In
summary, each step represents a function within the hera package. This
allows the re-use code and rules between existing and future tool
development.</p>
<p><strong>Steps</strong></p>
<p><strong>1. Validation</strong> <strong>2. Indices/metrics</strong>
<strong>3. Assessment</strong> <strong>4. Reporting</strong></p>
<p>The examples below illustrative of how this RFC could be implemented.
Keep in mind these <strong>examples are not full, complete or
accurate</strong>. The data structure, naming and details could all
change, they are presented as a rough draft.</p>
<div class="section level4" number="4.2.1">
<h4 id="validation">
<span class="header-section-number">4.2.1</span> Validation<a class="anchor" aria-label="anchor" href="#validation"></a>
</h4>
<ol style="list-style-type: decimal">
<li>Firstly, sense-check the predictor and observation data is with
expect limits and formatting rules.</li>
<li>Additionally, validation could check the data is within the expect
parameter space based on training data used to create the classification
model.</li>
</ol>
<p>The <code><a href="../reference/validation.html">validation()</a></code> function will returns the passing data
and list of warnings/fails.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># install.packages("devtools")</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="co"># devtools::install_github("ecodata1/hera")</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>demo_data <span class="ot">&lt;-</span> hera<span class="sc">::</span>demo_data</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">validation</span>(demo_data)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>data[<span class="dv">5</span>, ]</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co"># A tibble: 1 × 21</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>  location_id location_description           easting northing latitude longitude</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>       <span class="er">&lt;</span>fct<span class="sc">&gt;</span>                            <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>    <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>    <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>     <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="dv">1</span> <span class="dv">8175</span>        River Eden <span class="sc">@</span> Kemback Gauging …  <span class="dv">341452</span>   <span class="dv">715796</span>     <span class="fl">56.3</span>     <span class="sc">-</span><span class="fl">2.95</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co"># ℹ 15 more variables: date_taken &lt;dttm&gt;, sample_id &lt;chr&gt;, question &lt;chr&gt;,</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="co">#   response &lt;chr&gt;, mean_alkalinity &lt;dbl&gt;, grid_reference &lt;chr&gt;,</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co">#   standard &lt;chr&gt;, quality_element &lt;chr&gt;, water_body_id &lt;dbl&gt;, label &lt;fct&gt;,</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co">#   dist_from_source &lt;dbl&gt;, slope &lt;dbl&gt;, source_altitude &lt;dbl&gt;,</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="co">#   parameter &lt;chr&gt;, year &lt;dbl&gt;</span></span></code></pre></div>
</div>
<div class="section level4" number="4.2.2">
<h4 id="assess">
<span class="header-section-number">4.2.2</span> Assess<a class="anchor" aria-label="anchor" href="#assess"></a>
</h4>
<p>Using the <code><a href="../reference/assess.html">assess()</a></code> function, we can calculate as
required: <strong>1. Indices/Metrics (summary stats)</strong> <strong>2.
Predictions (output from models)</strong> <strong>3.
Classification/Reports (assessments combining summary and prediction
stats)</strong></p>
<p>The ‘assessment’ stage includes any type of index, test or
categorisation of our data. This could be WFD classification, compliance
check, bathing water or discharge assessment. Broadly, any type of
grading or assessment.</p>
<p>By default the <code><a href="../reference/assess.html">assess()</a></code> function we run all the
assessments possible based on the data provided.</p>
<p><code>r data %&gt;%    assess() %&gt;%   select(sample_id, question, response) %&gt;%   slice_sample(n = 4)</code></p>
<p>Alternatively, we can select a list of specific assessments from the
<code>catalogue</code> to run as required.</p>
<pre><code># A tibble: 2 × 1
  assessment               
  &lt;chr&gt;                    
1 Macroinvertebrate Metrics
2 DARLEQ3                  </code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>  <span class="fu">assess</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">"Macroinvertebrate Metrics"</span>,<span class="st">"DARLEQ3"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>  <span class="fu">select</span>(sample_id, question, response) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">4</span>)</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co"># A tibble: 4 × 3</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  sample_id question        response        </span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>     <span class="er">&lt;</span>chr<span class="sc">&gt;</span>           <span class="er">&lt;</span>chr<span class="sc">&gt;</span>           </span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="dv">1</span> <span class="dv">919681</span>    lake_TYPE       HA              </span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="dv">2</span> <span class="dv">3294945</span>   SPEAR class TL2 Good            </span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="dv">3</span> <span class="dv">1101214</span>   Riverfly ASPT   <span class="fl">2.33333333333333</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="dv">4</span> <span class="dv">621928</span>    EPSI Score TL2  <span class="fl">77.6726304894278</span></span></code></pre></div>
<div class="section level5" number="4.2.2.1">
<h5 id="assessment-reports">
<span class="header-section-number">4.2.2.1</span> Assessment
Reports<a class="anchor" aria-label="anchor" href="#assessment-reports"></a>
</h5>
<p>The <code>catalogue</code> can contain complex reporting assessments
that compile, group and presents one or more assessment output. For
instance running and presenting a number of WFD assessments, grouping by
water body and hierarchy for a River Basin Management Plan.</p>
<pre><code><span><span class="co"># TODO!</span></span>
<span><span class="fu"><a href="../reference/assess.html">assess</a></span><span class="op">(</span><span class="va">demo_data</span>, <span class="st">'rbmp_report'</span><span class="op">)</span> </span></code></pre>
</div>
<div class="section level5" number="4.2.2.2">
<h5 id="diagnosis">
<span class="header-section-number">4.2.2.2</span> Diagnosis<a class="anchor" aria-label="anchor" href="#diagnosis"></a>
</h5>
<p>As well as classification of water quality, additional we need to
diagnose potential pressures. Again, we can add a assessment to the
<code>catalogue</code> for diagnostic reporting. We use the
<code><a href="../reference/assess.html">assess()</a></code> function to build a custom report to help diagnose
potential pressures.</p>
<pre><code><span><span class="co"># TODO!</span></span>
<span><span class="fu"><a href="../reference/assess.html">assess</a></span><span class="op">(</span><span class="va">demo_data</span>, <span class="st">'diagnose_wfd_pressures'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">sample_id</span>, <span class="va">question</span>, <span class="va">response</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level5" number="4.2.2.3">
<h5 id="aggegation">
<span class="header-section-number">4.2.2.3</span> Aggegation<a class="anchor" aria-label="anchor" href="#aggegation"></a>
</h5>
<p>To facilitate general data exploration, an <code>aggregate</code>
helper function can group the outputs by season, year, multi-year or
water body as required. This allows a standard way to aggregate data
within the <code>hera</code> toolset.</p>
<pre><code><span><span class="va">aggregate</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">demo_data</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span>,<span class="st">"season"</span>,<span class="st">"waterbody"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">class</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level5" number="4.2.2.4">
<h5 id="compare">
<span class="header-section-number">4.2.2.4</span> Compare<a class="anchor" aria-label="anchor" href="#compare"></a>
</h5>
<p>A <code>compare</code> helper function allows generic comparison
between years, locations or samples to allow general data analysis and
comparison.</p>
<pre><code><span><span class="co"># TODO!</span></span>
<span><span class="va">compare_report</span> <span class="op">&lt;-</span> <span class="fu">compare</span><span class="op">(</span><span class="va">new_data</span>, <span class="va">old_data</span><span class="op">)</span></span>
<span><span class="va">compare_report</span></span></code></pre>
<p>Another, example of comparing two samples (perhaps up and
downstream):</p>
<pre><code><span><span class="co"># TODO!</span></span>
<span><span class="va">compare_report</span> <span class="op">&lt;-</span> <span class="fu">compare</span><span class="op">(</span><span class="va">site_one</span>, <span class="va">site_two</span><span class="op">)</span></span>
<span><span class="va">compare_report</span></span></code></pre>
</div>
<div class="section level5" number="4.2.2.5">
<h5 id="scenarios">
<span class="header-section-number">4.2.2.5</span> Scenarios<a class="anchor" aria-label="anchor" href="#scenarios"></a>
</h5>
<p>A number of forecasting or scenario tools could be incorporated for
either projecting current trends or assessing the impact of proposed
measures.</p>
<pre><code><span><span class="co"># TODO!</span></span>
<span><span class="fu"><a href="../reference/assess.html">assess</a></span><span class="op">(</span><span class="va">demo_data</span>, <span class="va">trends</span>, scenario<span class="op">=</span><span class="st">"wfd_forecast"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/assess.html">assess</a></span><span class="op">(</span><span class="va">demo_data</span>, <span class="va">measures</span>, scenario<span class="op">=</span><span class="st">"measure_impact"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
</div>
<div class="section level4" number="4.2.3">
<h4 id="the-whole-game">
<span class="header-section-number">4.2.3</span> The Whole Game<a class="anchor" aria-label="anchor" href="#the-whole-game"></a>
</h4>
<p>For the most part we don’t expect users to go through each of these
steps. But for developers and researchers it is useful to think about
classification within this framework of discrete steps. For the majority
of end users, agency staff or consultants, they can open the GUI
<code>hera_app()</code> or visit the website directly.</p>
<p>Furthermore, agencies can integrate these functions into their
systems using web services. Please see the <a href="https://cloud.opencpu.org/ocpu/apps/ecodata1/hera/info" class="external-link">demo web
service</a> and <a href="https://www.opencpu.org/api.html" class="external-link">api
documentation</a> for using <a href="https://www.opencpu.org/" class="external-link">opencpu</a> hosted packages.</p>
</div>
</div>
<div class="section level3" number="4.3">
<h3 id="lots-of-datasets---one-underlying-data-structure">
<span class="header-section-number">4.3</span> Lots of Datasets -
one underlying data structure?<a class="anchor" aria-label="anchor" href="#lots-of-datasets---one-underlying-data-structure"></a>
</h3>
<p>Models rely on observed sampling for training. Samples come in a
range of forms from points, transects, images, grabs, DNA etc. But the
general feature of modelling is based on being able to predict what we
expect to find from whatever sampling technique we deploy. The sample is
the fundamental observation which we compare against our prediction. The
samples are discreet, either observed instantaneously or perhaps over a
few minutes or hours (where dynamic changes are not significant).</p>
<p>Multiple samples can be aggregated to smooth variance but the sample
still remains the fundamental building block. The sample could be a
single pixel from an aerial image or a salmon moving through a fish
counter. We still make predictions of what we expect this sample to be
like even if the true picture only emerges after several samples are
aggregated or compared.</p>
<p>Therefore, all our data share similarities, they consist of samples
and observations. And additionally each sample will have predictor
variables to allow us to predict expected reference values or
outcomes.</p>
<div class="section level4" number="4.3.1">
<h4 id="data-dictionary">
<span class="header-section-number">4.3.1</span> Data
dictionary<a class="anchor" aria-label="anchor" href="#data-dictionary"></a>
</h4>
<p>There are a number of data dictionaries, <a href="https://en.wikipedia.org/wiki/Metadata_standard" class="external-link">metadata
standards</a> and <a href="https://en.wikipedia.org/wiki/Semantic_Web" class="external-link">semantic data</a>
definition across disciplines and organisations. It’s unclear exactly
how we define our input and output datasets. Therefore, we propose using
common definition and standards where possible. In a similar way to the
climate model communities use of the <a href="http://cfconventions.org/index.html" class="external-link">Climate and Forecast Standard
Names</a>.</p>
<p>The Europe Environment Agency has produced a <a href="https://dd.eionet.europa.eu/" class="external-link">data dictionary for reporting</a>.
However, this is mainly for high-level reporting. In particular,
taxonomic results are not exchanged using this data structure. However,
we use some aspects of this standard within hera to aid onward reporting
to EEA.</p>
</div>
<div class="section level4" number="4.3.2">
<h4 id="what-does-this-look-like">
<span class="header-section-number">4.3.2</span> What does this look
like?<a class="anchor" aria-label="anchor" href="#what-does-this-look-like"></a>
</h4>
<p>A small sample demo dataset <code>demo_data</code> contains diatoms,
macrophytes and inverts quality elements.</p>
<pre><code># A tibble: 5 × 4
# Groups:   quality_element [5]
  location_description             date_taken          sample_id quality_element
  &lt;fct&gt;                            &lt;dttm&gt;              &lt;chr&gt;     &lt;chr&gt;          
1 River Eden @ Kemback Gauging St… 2017-07-20 12:15:00 3256506   Algal_RQB      
2 River Eden @ Kemback Gauging St… 2013-10-09 13:29:00 2355899   Alien Species  
3 River Eden @ Kemback Gauging St… 2017-09-21 10:00:00 3294945   Comment        
4 River Eden @ Kemback Gauging St… 2009-04-15 12:54:00 1250462   Diatom Summary 
5 River Eden @ Kemback Gauging St… 2014-10-02 12:30:00 2632159   Diatom Survey …</code></pre>
</div>
<div class="section level4" number="4.3.3">
<h4 id="book-keeping-variables">
<span class="header-section-number">4.3.3</span> Book-keeping
variables<a class="anchor" aria-label="anchor" href="#book-keeping-variables"></a>
</h4>
<p>First of all, we have ‘book-keeping’ variables. These allow us to
reference data associated with particular samples, locations or WFD
methods. And allow results to be aggregate at different levels.</p>
<pre><code># A tibble: 5 × 4
  location_id sample_id date_taken          quality_element        
  &lt;chr&gt;       &lt;chr&gt;     &lt;dttm&gt;              &lt;chr&gt;                  
1 8175        3256506   2017-07-20 12:15:00 Macrophyte Reach Survey
2 8175        3256506   2017-07-20 12:15:00 Macrophyte Reach Survey
3 8175        3256506   2017-07-20 12:15:00 Macrophyte Reach Survey
4 8175        3256506   2017-07-20 12:15:00 Macrophyte Reach Survey
5 8175        3256506   2017-07-20 12:15:00 Macrophyte Reach Survey</code></pre>
<p>All data passed into hera must have these four variables. For <em>ad
hoc</em> reporting, consultancies and students etc who don’t routinely
record unique sample ids, a sample_id is generate if
<code>date_taken</code> and <code>location_id</code> are provided.</p>
<p>These three variables are the minimal required, but in practice
<code>water_body_id</code> maybe required for aggregation or simply
<code>location_description</code> or <code>NGR</code> etc to help
reference sites more easily. There is no restriction to the number of
extra columns and these extra columns will be appended to outputs.</p>
</div>
<div class="section level4" number="4.3.4">
<h4 id="observations">
<span class="header-section-number">4.3.4</span> Observations<a class="anchor" aria-label="anchor" href="#observations"></a>
</h4>
<p>An observation consists of three variables <code>question</code>,
<code>response</code>. The <code>question</code> variable identifies
what is being determined such as <code>alkalinity</code> or
<code>depth</code> etc. And the <code>response</code> is the value
observed or recorded for that question.</p>
<p>Below is an example of diatom records, invert data and river flow in
a shared input format.</p>
<pre><code># A tibble: 7,106 × 2
   question        response      
   &lt;chr&gt;           &lt;chr&gt;         
 1 Site altitude   7             
 2 Source altitude 210           
 3 nems alkalinity 118.8889      
 4 Mean alkalinity 118.8889      
 5 nems slope      2.6000        
 6 Slope           2.6000        
 7 Dist to source  36.4          
 8 Site NGR        NO 41452 15796
 9 Easting         341452        
10 Northing        715796        
# ℹ 7,096 more rows</code></pre>
<p>In theory, this is all that is required. However for ease for
interacting with existing datasets and <em>ad hoc</em> data, a third
column <code>label</code> is useful due to the historic way taxon data
is usually stored.</p>
<pre><code># A tibble: 5 × 3
  question               response label         
  &lt;chr&gt;                  &lt;chr&gt;    &lt;fct&gt;         
1 Taxon abundance        1        Hydropsychidae
2 Taxon abundance        50       Oligochaeta   
3 BMWP Score             7.0      Rhyacophilidae
4 TDLR                   3        Nitzschia sp. 
5 Plant functional group 0        Didymodon     </code></pre>
</div>
<div class="section level4" number="4.3.5">
<h4 id="predictors">
<span class="header-section-number">4.3.5</span> Predictors<a class="anchor" aria-label="anchor" href="#predictors"></a>
</h4>
<p>Predictive variables such as <code>temperature</code>,
<code>altitude</code>, <code>slope</code> are added as additional
columns. There is a trade-off here as predictor variables are added for
each row in the dataset, increasing the size of the dataset. However
this does make data analysis straightforward and this repeated data can
be easily compressed if size becomes an issue. For instance, nested JSON
data or dataframes in R.</p>
<pre><code># A tibble: 7,106 × 3
   mean_alkalinity grid_reference slope
             &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;
 1              75 NO 41452 15796     2
 2              75 NO 41452 15796     2
 3              75 NO 41452 15796     2
 4              75 NO 41452 15796     2
 5              75 NO 41452 15796     2
 6              75 NO 41452 15796     2
 7              75 NO 41452 15796     2
 8              75 NO 41452 15796     2
 9              75 NO 41452 15796     2
10              75 NO 41452 15796     2
# ℹ 7,096 more rows</code></pre>
</div>
<div class="section level4" number="4.3.6">
<h4 id="assessments">
<span class="header-section-number">4.3.6</span> Assessments<a class="anchor" aria-label="anchor" href="#assessments"></a>
</h4>
<p>The outputs are all presented in a consistent format making outputs
from different models instantly comparable and portable.</p>
</div>
</div>
<div class="section level3" number="4.4">
<h3 id="data-input">
<span class="header-section-number">4.4</span> Data Input<a class="anchor" aria-label="anchor" href="#data-input"></a>
</h3>
<p>For students and consultancies requiring <em>ad hoc</em> usage,
templates and documentation for preparing data will be provided.</p>
<p>For Agencies, data queries can be written to prepare outputs in the
correct format.</p>
<p>For instance, here is a prototype function to pull data Environment
Agency’s data.gov.uk web service and convert to the required
<code>hera</code> input format.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">environment_agency_data</span> <span class="op">&lt;-</span> <span class="fu">hera</span><span class="fu">:::</span><span class="fu"><a href="../reference/get_data.html">get_data</a></span><span class="op">(</span>location_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">43378</span>, <span class="fl">92751</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="va">environment_agency_data</span><span class="op">)</span></span></code></pre></div>
<p>We can then run this EA data through <code>hera</code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">report</span> <span class="op">&lt;-</span> <span class="fu">hera</span><span class="fu">::</span><span class="fu"><a href="../reference/assess.html">assess</a></span><span class="op">(</span><span class="va">environment_agency_data</span><span class="op">)</span></span>
<span><span class="va">report</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date_taken</span>, <span class="va">question</span>, <span class="va">response</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3" number="4.5">
<h3 id="shared-data-tables">
<span class="header-section-number">4.5</span> Shared Data
Tables<a class="anchor" aria-label="anchor" href="#shared-data-tables"></a>
</h3>
<p>Following data tables are shared through <code>hera</code>…</p>
<ul>
<li>Validation Rules</li>
<li>Indices, Model and Environmental Standards</li>
<li>Taxon Table</li>
<li>EQR / assessment / compliance boundaries</li>
<li>Parameter Hierarchy</li>
</ul>
<div class="section level4" number="4.5.1">
<h4 id="models-and-environmental-standards-names">
<span class="header-section-number">4.5.1</span> Models and
Environmental Standards names<a class="anchor" aria-label="anchor" href="#models-and-environmental-standards-names"></a>
</h4>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>hera<span class="sc">::</span>catalogue</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="co"># A tibble: 6 × 3</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>  assessment                data               assessment_function</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>  <span class="sc">&lt;</span>chr<span class="sc">&gt;</span>                     <span class="er">&lt;</span>list<span class="sc">&gt;</span>             <span class="er">&lt;</span>list<span class="sc">&gt;</span>             </span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="dv">1</span> Bacterial Tufts           <span class="sc">&lt;</span>tibble [<span class="dv">10</span> × <span class="dv">12</span>]<span class="sc">&gt;</span> <span class="er">&lt;</span>fn<span class="sc">&gt;</span>               </span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="dv">2</span> Macroinvertebrate Metrics <span class="sc">&lt;</span>tibble [<span class="dv">22</span> × <span class="dv">10</span>]<span class="sc">&gt;</span> <span class="er">&lt;</span>fn<span class="sc">&gt;</span>               </span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="dv">3</span> Bankside Consistency      <span class="sc">&lt;</span>tibble [<span class="dv">17</span> × <span class="dv">12</span>]<span class="sc">&gt;</span> <span class="er">&lt;</span>fn<span class="sc">&gt;</span>               </span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="dv">4</span> MPFF Compliance           <span class="sc">&lt;</span>tibble [<span class="dv">34</span> × <span class="dv">10</span>]<span class="sc">&gt;</span> <span class="er">&lt;</span>fn<span class="sc">&gt;</span>               </span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="dv">5</span> DARLEQ3                   <span class="sc">&lt;</span>tibble [<span class="dv">36</span> × <span class="dv">12</span>]<span class="sc">&gt;</span> <span class="er">&lt;</span>fn<span class="sc">&gt;</span>               </span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="dv">6</span> RICT                      <span class="sc">&lt;</span>tibble [<span class="dv">30</span> × <span class="dv">12</span>]<span class="sc">&gt;</span> <span class="er">&lt;</span>fn<span class="sc">&gt;</span>               </span></code></pre></div>
</div>
</div>
<div class="section level3" number="4.6">
<h3 id="model-platform">
<span class="header-section-number">4.6</span> Model platform<a class="anchor" aria-label="anchor" href="#model-platform"></a>
</h3>
<p>This RFC is mainly looking at a share design for inputs and outputs
from classification tools.</p>
<p>This framework does however encourage a shared principles in thinking
about the approach to modelling required which drives the classification
method. However, we see no need to prescribe a modelling program or
software. Researchers can download the reference and predictor data
required and use any software they desire. Ultimately, the model we need
to be called by R. So either the model needs to be written into R or in
language which can be called by R (Python, fortran, C++ etc).</p>
<p>Alternatively, if researchers can’t provide an api for R to call, the
recommendation is to use R - which integrates more directly into the
pipeline.</p>
<p>Once modelling is completed, the model object is saved and deployed.
Any existing or future data collected using the platform will be run
through the model at the sample level.</p>
<p>Researchers can then build tools to display and aggregate the sample
level results as required (Waterbody, Year, Catchment etc). Where it
would be possible to share techniques for producing Confidence of Class,
assessment of data suitability and adjustment factors etc.</p>
</div>
</div>
<div class="section level2" number="5">
<h2 id="how-we-teach-this">
<span class="header-section-number">5</span> How We Teach This<a class="anchor" aria-label="anchor" href="#how-we-teach-this"></a>
</h2>
<p>As new regulatory developments and updates requirements are
identified, the lead contacts from the agencies and method developers
are ‘on-boarded’ to demonstrate the design principles and collaborative
framework of packages. Where skill development is required further
training can be provided, or additional external or internal support
from the agency commissioning the work.</p>
<p>A workshop for lead data experts / R coders from each agency delivers
institutional knowledge on how internally developed tools will fit with
the shared design philosophy as well as setting expectations for
collaboration with external researchers.</p>
<div class="section level3" number="5.1">
<h3 id="sharing">
<span class="header-section-number">5.1</span> Sharing<a class="anchor" aria-label="anchor" href="#sharing"></a>
</h3>
<p>Hera allows multiple ecological elements to be assessed through the
same interface. But not just the interface is shared. Other areas of the
infrastructure are shared including:</p>
<ul>
<li>Reporting and comparison tools can also be shared between multiple
elements.</li>
<li>Validation checks and other universally required mechanisms are
shared and easily configurable for new models/methods.</li>
<li>Testing infrastructure.</li>
<li>Confidence of class and data suitability algorithms.</li>
</ul>
</div>
<div class="section level3" number="5.2">
<h3 id="organisation">
<span class="header-section-number">5.2</span> Organisation<a class="anchor" aria-label="anchor" href="#organisation"></a>
</h3>
<p>All UKTAG sub-groups and their nominated leads in the devolved
agencies would contribute new method develops and tools to the shared
collection of packages. Where tools are agency specific, these could
also make use of the platform if required.</p>
<p>As agencies commission new tools to be developed, researchers can
upload their predictive variables, reference data and models into a
central repo for easier collaboration.</p>
</div>
</div>
<div class="section level2" number="6">
<h2 id="alternatives">
<span class="header-section-number">6</span> Alternatives<a class="anchor" aria-label="anchor" href="#alternatives"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>Status Quo - Future development takes the form of bespoke, custom
code in self-contained R packages or Excel spreadsheets. No code re-use,
collaboration or consistency against tools/metrics/assessments.</p></li>
<li><p>Other computational document standards such as Python Julia, JS
based Jupiter or Quarto documents. Currently, most of our code is either
Excel or R based. We wish to avoid re-writing R code into other
languages. But this doesn’t preclude future developments using other
languages or computational document standards.</p></li>
<li><p>Web assembly - Compile our R, Python, Julia, C++ etc into widely
supported Web Assembly language for fast use within web browser (on or
offline). This is only at a prototype stage in R and Python and many
existing libraries cannot compile to Web Assembly. Possibly in future
this may be an option. But current tools for integrating and combining
languages provide broad enough consistency/compatibility even if a
back-end server is required. Requiring a back-end server can impact
offline or native usage in some situations such on mobile devices. For
instance, R only supports MacOS, Linux and Windows. R isn’t officially
supported to run locally/natively on Android or iOS. On these devices, R
must run in a web server and requires mobile/wifi signal to communicate
with the device. Using Web Assembly in future may avoid the need for
web-server for mobile / offline devices.</p></li>
</ol>
</div>
<div class="section level2" number="7">
<h2 id="unresolved-questions">
<span class="header-section-number">7</span> Unresolved
Questions<a class="anchor" aria-label="anchor" href="#unresolved-questions"></a>
</h2>
<ul>
<li>Should all reference/predictor data be combined into a single
repository / web service?</li>
</ul>
</div>
<div class="section level2" number="8">
<h2 id="appendix">
<span class="header-section-number">8</span> Appendix<a class="anchor" aria-label="anchor" href="#appendix"></a>
</h2>
<div class="section level3" number="8.1">
<h3 id="list-of-current-data-structures-in-r-packages">
<span class="header-section-number">8.1</span> List of Current Data
Structures in R packages<a class="anchor" aria-label="anchor" href="#list-of-current-data-structures-in-r-packages"></a>
</h3>
<div class="section level4" number="8.1.1">
<h4 id="fcs2-tool">
<span class="header-section-number">8.1.1</span> FCS2 tool<a class="anchor" aria-label="anchor" href="#fcs2-tool"></a>
</h4>
<p>Demo input data format (truncated) and full list of column names</p>
<pre><code> DataHeldBy SiteCode Alternative.site.code Repeat.check SiteName
1         EA   525052                    NA            N    13809
2         EA   507441                    NA            Y    13810
3         EA   525051                    NA            N    34611
4         EA   122881                    NA            Y     5435
  Site.description ...
1            13809 ...
2            13810 ...
3            34611 ...
4             5435 ...
 [1] #DataHeldBy#                 #SiteCode#                  
 [3] #Alternative.site.code#      #Repeat.check#              
 [5] #SiteName#                   #Site.description#          
 [7] #Easting#                    #Northing#                  
 [9] #NGR#                        #SurveyDate#                
[11] #WBId#                       #WBName#                    
[13] #NumberOfRuns#               #SurveyArea#                
[15] #WetWidth#                   #Slope#                     
[17] #BarrierType#                #ImpassableBarriers#        
[19] #Sense.check.passed.#        #CatchmentAreaUpstream#     
[21] #CatchmentDrainageDirection# #GeologyClass#              
[23] #Altitude#                   #DistanceFromSource#        
[25] #DistanceToSea#              #AnnualMeanFlow#            
[27] #AlkalinityValue#            #TotalPValue#               
[29] #DOCValue#                   #SuspendedSolidsValue#      
[31] #IOH.hydrometric.area#       #HydrometricAreaNo#         
[33] #LandUse.AgriculturalAreas#  #LandUse.ConiferousForests# 
[35] #LandUse.Wetlands#           #Substrate.Small#           
[37] #Substrate.Large#            #Substrate.Bedrock#         
[39] #Salmon_fry.Run1Total#       #Salmon_fry.Run2Total#      
[41] #Salmon_fry.Run3Total#       #Salmon_fry.Run4Total#      
[43] #Salmon_parr.Run1Total#      #Salmon_parr.Run2Total#     
[45] #Salmon_parr.Run3Total#      #Salmon_parr.Run4Total#     
[47] #Trout_fry.Run1Total#        #Trout_fry.Run2Total#       
[49] #Trout_fry.Run3Total#        #Trout_fry.Run4Total#       
[51] #Trout_parr.Run1Total#       #Trout_parr.Run2Total#      
[53] #Trout_parr.Run3Total#       #Trout_parr.Run4Total# </code></pre>
<p>Ouput</p>
<pre><code>WBName ...
1         EA 03/09/2015   525052    13809 10675                          ...
2         EA 04/09/2015   507441    13810 10675 White Esk (u/s Rae Burn) ...
3         EA 03/09/2015   525051    34611 10676                          ...
4         EA 01/09/2015   122881     5435 10676            Garwald Water ...
 [1] #DataHeldBy#                                 
 [2] #SurveyDate#                                 
 [3] #SiteCode#                                   
 [4] #SiteName#                                   
 [5] #WBId#                                       
 [6] #WBName#                                     
 [7] #All species WB EQR Bad %#                   
 [8] #All species WB EQR Poor %#                  
 [9] #All species WB EQR Moderate %#              
[10] #All species WB EQR Good %#                  
[11] #All species WB EQR High %#                  
[12] #All species WB EQR mean#                    
[13] #All species survey EQR Bad %#               
[14] #All species survey EQR Poor %#              
[15] #All species survey EQR Moderate %#          
[16] #All species survey EQR Good %#              
[17] #All species survey EQR High %#              
[18] #All species survey EQR mean#                
[19] #Salmon_fry WB EQR mean#                     
[20] #Salmon_fry survey EQR mean#                 
[21] #Salmon_fry observed total catch#            
[22] #Salmon_fry probability present#             
[23] #Salmon_fry expected total catch if present# 
[24] #Salmon_fry expected total catch#            
[25] #Salmon_parr WB EQR mean#                    
[26] #Salmon_parr survey EQR mean#                
[27] #Salmon_parr observed total catch#           
[28] #Salmon_parr probability present#            
[29] #Salmon_parr expected total catch if present#
[30] #Salmon_parr expected total catch#           
[31] #Trout_fry WB EQR mean#                      
[32] #Trout_fry survey EQR mean#                  
[33] #Trout_fry observed total catch#             
[34] #Trout_fry probability present#              
[35] #Trout_fry expected total catch if present#  
[36] #Trout_fry expected total catch#             
[37] #Trout_parr WB EQR mean#                     
[38] #Trout_parr survey EQR mean#                 
[39] #Trout_parr observed total catch#            
[40] #Trout_parr probability present#             
[41] #Trout_parr expected total catch if present# 
[42] #Trout_parr expected total catch#      </code></pre>
</div>
<div class="section level4" number="8.1.2">
<h4 id="darleq-tool">
<span class="header-section-number">8.1.2</span> Darleq Tool<a class="anchor" aria-label="anchor" href="#darleq-tool"></a>
</h4>
<p>Input data for DARLEQ3 tool is a list of dataframes. Here’s an
example of input data format (truncated) and full list of column
names</p>
<pre><code>         AC023A AC083A AC143A AC161A AC9999  AD009A   AM001A AM004A ...
SPR001 0.000000      0      0      0      0 0.31348 0.000000      0 ...
AUT001 0.000000      0      0      0      0 0.00000 0.000000      0 ...
SPR002 0.332226      0      0      0      0 0.00000 0.332226      0 ...
AUT002 0.000000      0      0      0      0 0.00000 0.000000      0 ...
  [1] "AC023A" "AC083A" "AC143A" "AC161A" "AC9999" "AD009A" "AM001A" "AM004A"
  [9] "AM011A" "AM012A" "AM013A" "AM084A" "AM9999" "AP001A" "AS001A" "AS003A"
 [17] "AU003A" "AU9999" "BR001A" "BR9999" "CA002A" "CA9999" "CC9999" "CI002A"
 [25] "CI005A" "CL001A" "CM004A" "CM006A" "CM007A" "CM009A" "CM013A" "CM022A"
 [33] "CM038A" "CM041A" "CM9999" "CN001A" "CO001A" "CO001B" "CO001C" "CO005A"
 [41] "CO010A" "CO9999" "CV001A" "CV005A" "CY003A" "CY011A" "CY019A" "CY9999"
 [49] "DD001A" "DE001A" "DP007A" "DP012A" "DP9999" "DT003A" "DT004A" "DT010A"
 [57] "DT021A" "DT022A" "DT9999" "EC001A" "EL001A" "EP9999" "EU002A" "EU009A"
 [65] "EU009C" "EU047A" "EU070A" "EU9999" "EY003A" "EY004A" "EY005A" "EY011A"
 [73] "EY015A" "EY016A" "EY017A" "EY9999" "FA021A" "FF001A" "FF002A" "FF9999"
 [81] "FR007A" "FR007C" "FR008A" "FR009A" "FR009B" "FR019A" "FR026A" "FR9999"
 [89] "FU001A" "FU002A" "FU037A" "GO001A" "GO003A" "GO004A" "GO006A" "GO013A"
 [97] "GO013C" "GO019A" "GO023A" "GO023B" "GO024C" "GO027A" "GO029A" "GO050A"
[105] "GO052A" "GO055A" "GO066A" "GO9999" "GY001A" "GY005A" "HA001A" "HN001A"
[113] "LU001A" "LU003A" "MA9999" "ME015A" "MR001A" "MR001B" "NA003A" "NA007A"
[121] "NA008A" "NA009A" "NA021A" "NA023A" "NA026A" "NA027A" "NA030A" "NA035A"
[129] "NA037A" "NA042A" "NA051A" "NA054A" "NA063A" "NA066A" "NA080A" "NA084A"
[137] "NA095A" "NA112A" "NA114A" "NA124A" "NA134A" "NA433A" "NA433D" "NA462A"
[145] "NA675A" "NA745A" "NA751A" "NA764A" "NA768A" "NA9999" "NE008A" "NI002A"
[153] "NI005A" "NI006A" "NI008A" "NI009A" "NI010A" "NI014A" "NI015A" "NI017A"
[161] "NI021A" "NI024A" "NI025A" "NI027A" "NI028A" "NI031A" "NI033A" "NI034A"
[169] "NI042A" "NI043A" "NI044A" "NI046A" "NI049A" "NI052A" "NI065A" "NI080A"
[177] "NI099A" "NI110A" "NI152A" "NI164B" "NI166A" "NI171A" "NI198A" "NI199A"
[185] "NI212A" "NI9999" "PE002A" "PI014A" "PI9999" "PS001A" "RC002A" "RE001A"
[193] "SA003A" "SA012A" "SL001A" "SL002A" "SR001A" "SR002A" "SS002A" "SS003A"
[201] "ST001A" "ST9999" "SU001A" "SU032A" "SU073A" "SU9999" "SY001A" "SY003A"
[209] "SY004A" "SY004B" "SY013A" "SY043A" "TA001A" "TA002A" "TE003A" "TF003A"
[217] "TF015A" "TF9999" "TH038A" "TU003A" "UN9994" "UN9995" "YH001A" "ZZZ834"
[225] "ZZZ835" "ZZZ842" "ZZZ844" "ZZZ846" "ZZZ847" "ZZZ852" "ZZZ859" "ZZZ866"
[233] "ZZZ869" "ZZZ871" "ZZZ872" "ZZZ885" "ZZZ887" "ZZZ888" "ZZZ893" "ZZZ895"
[241] "ZZZ896" "ZZZ897" "ZZZ900" "ZZZ901" "ZZZ905" "ZZZ907" "ZZZ908" "ZZZ910"
[249] "ZZZ911" "ZZZ912" "ZZZ920" "ZZZ921" "ZZZ922" "ZZZ923" "ZZZ926" "ZZZ927"
[257] "ZZZ939" "ZZZ941" "ZZZ949" "ZZZ953" "ZZZ980" "ZZZ982" "ZZZ985" "ZZZ986"
[265] "ZZZ987"
[1] "SampleID"    "SiteID"      "SAMPLE_DATE" "Alkalinity"  "Stream"     
[6] "Reach"      </code></pre>
<p>Output (list of dataframes)</p>
<pre><code>       N_TDI5LM N2_TDI5LM Max_TDI5LM   TDI5LM  eTDI5LM
SPR001       41     12.39      16.93 55.60483 68.49447
AUT001       23      3.09      51.57 70.01608 68.49447
SPR002       55     13.14      20.93 70.66666 69.28261
AUT002       39      7.69      26.91 66.08840 69.28261
SPR003       39      9.37      27.30 50.40770 65.48689
AUT003       32      5.87      37.14 39.65652 65.48689
   CoCB   ROM  CoCHG CoCMPB ROM_GM
43 0.00 20.41  98.43   1.57   1.57
33 0.00 39.91  96.99   3.01   3.01
42 0.00  0.00 100.00   0.00   0.00
41 0.00  0.00 100.00   0.00   0.00
36 0.21 87.48  12.56  87.44  12.56
35 0.00 28.74  86.12  13.88  13.88
[1] "TDI5LM"
$N_samples
[1] 100

$N_samples_gt_zero
[1] 100

$N_taxa
[1] 265

$N_taxa_gt_zero
[1] 265</code></pre>
</div>
<div class="section level4" number="8.1.3">
<h4 id="rict">
<span class="header-section-number">8.1.3</span> RICT<a class="anchor" aria-label="anchor" href="#rict"></a>
</h4>
<p>Here’s an example of input data format (truncated) and full list of
column names</p>
<pre><code>         SITE      Waterbody Year NGR Easting Northing Altitude Slope ...
1 MYR-GB-01-R Waterbody name 2016  SE   94200    91000       60   2.7 ...
2 MYR-GB-01-R Waterbody name 2017  SE   94200    91000       60   2.7 ...
3 MYR-GB-01-R Waterbody name 2018  SE   94200    91000       60   2.7 ...
4 MYR-GB-05-R Waterbody name 2016  TL   92100    27200       15   1.3 ...
 [1] "SITE"                             "Waterbody"                       
 [3] "Year"                             "NGR"                             
 [5] "Easting"                          "Northing"                        
 [7] "Altitude"                         "Slope"                           
 [9] "Discharge"                        "Velocity"                        
[11] "Dist_from_Source"                 "Mean_Width"                      
[13] "Mean_Depth"                       "Alkalinity"                      
[15] "Boulder_Cobbles"                  "Pebbles_Gravel"                  
[17] "Sand"                             "Silt_Clay"                       
[19] "Hardness"                         "Calcium"                         
[21] "Conductivity"                     "Spr_Season_ID"                   
[23] "Spr_TL2_WHPT_ASPT (AbW,DistFam)"  "Spr_TL2_WHPT_NTaxa (AbW,DistFam)"
[25] "Spr_Ntaxa_Bias"                   "Sum_Season_ID"                   
[27] "Sum_TL2_WHPT_ASPT (AbW,DistFam)"  "Sum_TL2_WHPT_NTaxa (AbW,DistFam)"
[29] "Sum_Ntaxa_Bias"                   "Aut_Season_ID"                   
[31] "Aut_TL2_WHPT_ASPT (AbW,DistFam)"  "Aut_TL2_WHPT_NTaxa (AbW,DistFam)"
[33] "Aut_Ntaxa_Bias"                  </code></pre>
<p>Output</p>
<pre><code>  ROW        SITE YEAR FAIL
1  11 TST-NI-11-R 2018  ---
2  15 TST-NI-03-D 2018  ---
3  16 TST-NI-04-D 2018  ---
4  17 TST-NI-05-D 2018  ---
5  23 TST-NI-11-D 2018  ---
6   3 TST-NI-03-R 2018  ---
7   4 TST-NI-04-R 2018  ---
8   5 TST-NI-05-R 2018  ---
                                                                               WARNING
1 You provided LATITUDE: 55.2233002776773, max value used to train model: 55.1995835. 
2 You provided LATITUDE: 55.2015356650978, max value used to train model: 55.1995835. 
3 You provided LATITUDE: 55.2255867691652, max value used to train model: 55.1995835. 
4 You provided LATITUDE: 55.2082654209923, max value used to train model: 55.1995835. 
5 You provided LATITUDE: 55.2233002776773, max value used to train model: 55.1995835. 
6 You provided LATITUDE: 55.2015356650978, max value used to train model: 55.1995835. 
7 You provided LATITUDE: 55.2255867691652, max value used to train model: 55.1995835. 
8 You provided LATITUDE: 55.2082654209923, max value used to train model: 55.1995835. 
  REPLACEMENT
1         ---
2         ---
3         ---
4         ---
5         ---
6         ---
7         ---
8         ---
         SITE YEAR      WATERBODY H_NTAXA_spr_aut G_NTAXA_spr_aut
1 TST-NI-01-R 2018 Waterbody name           99.34            0.66
2 TST-NI-02-R 2018 Waterbody name            2.84           30.77
3 TST-NI-03-R 2018 Waterbody name           88.03            11.6
4 TST-NI-04-R 2018 Waterbody name           99.85            0.15
  M_NTAXA_spr_aut ...
1               0 ...
2           55.33 ...
3            0.37 ...
4               0 ...
 [1] "SITE"                              "YEAR"                             
 [3] "WATERBODY"                         "H_NTAXA_spr_aut"                  
 [5] "G_NTAXA_spr_aut"                   "M_NTAXA_spr_aut"                  
 [7] "P_NTAXA_spr_aut"                   "B_NTAXA_spr_aut"                  
 [9] "mostProb_NTAXA_spr_aut"            "NTAXA_aver_spr_aut"               
[11] "H_ASPT_spr_aut"                    "G_ASPT_spr_aut"                   
[13] "M_ASPT_spr_aut"                    "P_ASPT_spr_aut"                   
[15] "B_ASPT_spr_aut"                    "mostProb_ASPT_spr_aut"            
[17] "ASPT_aver_spr_aut"                 "mintawhpt_spr_aut_H_MINTA_"       
[19] "mintawhpt_spr_aut_G_MINTA_"        "mintawhpt_spr_aut_M_MINTA_"       
[21] "mintawhpt_spr_aut_P_MINTA_"        "mintawhpt_spr_aut_B_MINTA_"       
[23] "mintawhpt_spr_aut_mostProb_MINTA_"</code></pre>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Tim Foster.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
